// !! base64 key 随 PX 脚本版本变化, 更新后需重新提取所有 key
// !! 指纹哈希值 (canvas/webgl/audio/MD5/CRC32) 需从真实浏览器采集一次后写死
// !! 228 字段, 按 JSON 解码顺序排列, 分类注释
//
// opts:
//   uuid       — Xa() 生成的会话 UUID
//   serverTs   — ob 响应中 no (服务器时间戳)
//   obAppId    — ob 响应中 appId (如 "d6fb6vl15ubc73cjiet0")
//   obStatus   — ob 响应中 ao (如 680)
//   px3Cookie  — 当前 _px3 cookie 值
//   nsToken    — /ns 端点返回的 token (Sm)

function buildBundle2Event(opts) {
    var now = Date.now();
    var initTs = now - Math.floor(2500 + Math.random() * 1000);
    var collectTs = now + Math.floor(300 + Math.random() * 200);
    var buildTs = now + Math.floor(2800 + Math.random() * 600);

    return [{
        "t": "XiVuJBhOYBY=",
        "d": {

            "JxwXHWF2Ey4=": opts.serverTs,                              // #1  ob 服务器时间戳,
            "GC8oLl1DLxs=": 1,                                         // #2  blockScript flag,
            "fgUORDhuCn4=": 3,                                         // #3  collect stage (3=bundle),
            "DXJ9M0sVcgU=": "TypeError: Cannot read properties of null (reading '0')\n    at Fr (https://client.px-cloud.net/PXO1GDTa7Q/main.min.js:2:21510)\n    at Kd (https://client.px-cloud.net/PXO1GDTa7Q/main.min.js:2:123468)\n    at Wd (https://client.px-cloud.net/PXO1GDTa7Q/main.min.js:2:121382)\n    at https://client.px-cloud.net/PXO1GDTa7Q/main.min.js:2:127229",  // #4,
            "PSINY3tKDlQ=": location.href,                              // #5  location.href,
            "TBN8Ugp4cmc=": [location.origin],                         // #6  ancestor origins,
            "HCMsIllNKRM=": encodeURIComponent(location.href),         // #7  URL编码,
            "DhU+VEh4OmE=": false,                                     // #8  navigator.webdriver,
            "T3Q/NQkSPAA=": true,                                      // #9  localStorage,
            "eyBLYT1GTFc=": "4f19f01bd85bb61f3917e0e702a0c3be",        // #10 综合指纹 MD5,
            "EwhjCVZnZTM=": opts.obAppId,                              // #11 ob appId (短格式),
            "WiFqIBxIaRQ=": "1d1d771e72c68ca5d453242189a5fb42",        // #12 环境指纹 MD5,
            "CzB7cU1de0I=": "c4807e98344a77be7af5f09fc891d052",        // #13 浏览器特征 MD5,
            "DXJ9M0gZegA=": "f1085bff8e362a00440c9e55d5a4c9d0",        // #14 Canvas/WebGL MD5,
            "BFs0GkEzOio=": navigator.cookieEnabled,                   // #15 cookieEnabled,
            "AEcwBkUvNzQ=": {"37k":false,"DgwOD":94059,"0jG8i":"imAMamRvB"}, // #16 PX internal state,
            "PANMQnlvTHg=": true,                                      // #17 fetch,
            "ICdQJmZPXhA=": false,                                     // #18 ActiveXObject (IE),
            "JDtUOmFXWgw=": false,                                     // #19 window.opera,
            "PkVOBHsuSDI=": true,                                      // #20 XMLHttpRequest,
            "MDdANnVcRgE=": "TypeError: Cannot read properties of undefined (reading 'width')", // #21 WebGL error,
            "PkVOBHsuSDA=": "webkit",                                  // #22 vendor prefix,
            "QllyGAcydC0=": 33,                                        // #23 AudioContext sampleRate/1000,
            "UiliKBdCZBI=": false,                                     // #24 ChromeDriver cdc_,
            "GmEqYF8KKVc=": false,                                     // #25 (detection),
            "aH8Yfi0UFk8=": false,                                     // #26 chrome missing,
            "KD9YPm1UVgk=": "AudioData.SVGAnimatedAngle.SVGMetadataElement", // #27 DOM interface fingerprint,
            "DhU+VEt4OmY=": "109|66|66|70|80",                        // #28 timing chain,
            "R3w3PQEVMAo=": 501,                                       // #29 score,
            "DXJ9M0sVeQk=": true,                                     // #30 sendBeacon,
            "cRZBFzd+Ric=": true,                                     // #31 IntersectionObserver,
            "fEMMAjktCTE=": "false",                                   // #32 webdriver (string 类型),
            "V0wnTRImIn4=": "false",                                   // #33 headless mode (string),
            "VQolCxBlID0=": 1,                                         // #34 PX iteration,
            "HCMsIlpLKxk=": 1,                                        // #35 integrity score,
            "SlF6EA89dCM=": "",                                        // #36 previous session token,
            "cyhDaTVOTFo=": ["loadTimes","csi","app"],                 // #37 Object.keys(chrome),
            "b1RfVSo8UGM=": true,                                      // #38 Promise / cookie writable,
            "eW5JLzwASBQ=": ["PDF Viewer","Chrome PDF Viewer","Chromium PDF Viewer","Microsoft Edge PDF Viewer","WebKit built-in PDF"], // #39,
            "VGtkahEHa14=": 5,                                         // #40 plugins.length,
            "UBdgVhZ8YGI=": true,                                     // #41 Worker,
            "TlV+FAs4eC4=": true,                                     // #42 SharedWorker,
            "GU5pT18jZnk=": true,                                      // #43 sessionStorage,
            "LnVedGgTUUA=": true,                                      // #44 indexedDB,
            "MklCCHQiTTk=": navigator.language,                        // #45 "zh-CN",
            "HmUuZFsPLF4=": navigator.platform,                       // #46 "Win32",
            "FwxnDVFkaD4=": navigator.languages ? Array.from(navigator.languages) : [], // #47,
            "P2QPJXkNDRM=": navigator.userAgent,                       // #48 UA,
            "Zj0WPCNTEgk=": navigator.onLine,                         // #49 onLine,
            "W0ArQR0tJXM=": new Date().getTimezoneOffset(),            // #50 -480,
            "ZHsUeiITEUk=": navigator.hardwareConcurrency || 8,        // #51 CPU 线程数,
            "cgkCSDRhAH0=": navigator.deviceMemory || 4,               // #52 设备内存 (GB),
            "LnVedGsbUUc=": navigator.product,                        // #53 "Gecko",
            "NSoFa3NNAlE=": navigator.productSub,                     // #54 "20030107",
            "T3Q/NQoZOQM=": navigator.appVersion,                     // #55 appVersion,
            "a1BbUS02Xmo=": true,                                     // #56 MutationObserver,
            "Bh02XEB3N2o=": true,                                     // #57 ResizeObserver,
            "DzR/dUpafUM=": 2,                                         // #58  visualViewport.scale,
            "FwxnDVFqYj4=": navigator.appName,                        // #59 "Netscape",
            "dg0GTDBnBnc=": navigator.appCodeName,                    // #60 "Mozilla",
            "X0QvRRksL3M=": true,                                     // #61 Intl,
            "KD9YPm1TWw0=": window.scrollY || 0,                      // #62  scrollY (二次采集),
            "dEsECjImBDo=": false,                                     // #63 (bot detection),
            "GC8oLl5HJx8=": 10,                                        // #64 downlink (Mbps),
            "Bzx3fUFXdk4=": "4g",                                      // #65 effectiveType,
            "fyRPZTlCT1A=": true,                                     // #66 PerformanceObserver,
            "W0ArQR4vLHM=": true,                                     // #67 AbortController,
            "bRJdEyh6XCA=": true,                                     // #68 AudioContext,
            "fEMMAjkpDDc=": true,                                     // #69 WebAssembly,
            "dEsECjEgAz4=": "x86",                                     // #70 architecture,
            "BXp1O0ARcg4=": "64",                                      // #71 bitness,
            "IUYRR2QtFn0=": [{"brand":"Not:A-Brand","version":"99"},{"brand":"Microsoft Edge","version":"145"},{"brand":"Chromium","version":"145"}], // #72,
            "JxwXHWJ3ECY=": false,                                     // #73 showModalDialog,
            "QllyGAcydCo=": "",                                        // #74 vendorSub (空),
            "RTo1ewBRM0g=": "Windows",                                 // #75 platform,
            "EwhjCVZjZTk=": "19.0.0",                                 // #76 platformVersion,
            "HwRvBVpvaTQ=": "145.0.3800.70",                          // #77 fullVersion,
            "S3A7MQ4bOAs=": true,                                     // #78 getBattery,
            "GU5pT1wlanQ=": true,                                     // #79 Notification,
            "KnFacG8cW0A=": "f49f18dbec5558a76590af096c339826",        // #80 字体/插件 MD5,
            "GmEqYF8JJVo=": true,                                     // #81 matchMedia/RAF,
            "KV4ZX282Fmg=": 16,                                        // #82 MAX_TEXTURE_SIZE (log2),
            "FUplS1AiZXs=": false,                                     // #83 Proxy detection,
            "KxAbEW54HCc=": true,                                     // #84 crypto,
            "HwRvBVpsaDI=": {"sRx":672.7,"84aEh":true},               // #85 PX internal state,
            "QAdwRgVpdHI=": true,                                     // #86 performance,
            "dg0GTDNgBHg=": true,                                     // #87 Proxy,
            "IUYRR2ctFHc=": true,                                     // #88 Reflect,
            "eyBLYT5MTFc=": true,                                     // #89 Symbol,
            "P2QPJXkPCB8=": "49e5084e",                                // #90 Canvas emoji hash,
            "OkFKAHwrSDA=": "7c5f9724",                                // #91 Canvas glyph hash,
            "IUYRR2QqF30=": "65d826e0",                                // #92 WebGL renderer hash,
            "R3w3PQIWOA4=": "a9269e00",                                // #93 WebGL extensions hash,
            "AEcwBkYuPzQ=": "50a5ec55",                                // #94 WebGL params hash,
            "bRJdEyh6XCM=": "73a0fb26",                                // #95 WebGL unmasked hash,
            "AWZxJ0QOcBE=": true,                                     // #96 mediaDevices,
            "egEKQD9pC3c=": true,                                     // #97 credentials,
            "PkVOBHstTzA=": true,                                     // #98 (API detection),
            "aR5ZHyx2WCo=": false,                                     // #99 (detection),
            "MVYBV3Q+AG0=": true,                                     // #100 WebSocket,
            "DzR/dUpcfk4=": true,                                     // #101 (API detection),
            "HwRvBVpsbzc=": true,                                     // #102 (API detection),
            "OA9ITn5pS38=": screen.width,                              // #103 1920,
            "egEKQDxoBXM=": screen.height,                             // #104 1080,
            "Vi1mLBNCYx8=": screen.availWidth,                         // #105 1920,
            "MDdANnVYRQw=": screen.availHeight,                        // #106 1032,
            "AhkyWEd0PW0=": screen.width + "X" + screen.height,       // #107 "1920X1080",
            "GwBrAV5ubDA=": screen.colorDepth,                         // #108 32,
            "GwBrAV1tZDM=": screen.pixelDepth,                         // #109 32,
            "eyBLYT5IRFU=": window.screenX || 0,                      // #110 screenX,
            "Y1hTWSYwXGw=": window.screenY || 0,                      // #111 screenY,
            "TlV+FAg/cCI=": window.innerWidth,                        // #112 viewport width,
            "PkVOBHsvSDc=": window.innerHeight,                        // #113 viewport height,
            "dg0GTDNnBX0=": window.scrollX || 0,                      // #114 scrollX,
            "JDtUOmFRVw8=": window.scrollY || 0,                      // #115 scrollY,
            "NSoFa3NBAVo=": true,                                     // #116 Blob/File,
            "Zj0WPCNTFgc=": false,                                     // #117 doNotTrack,
            "AhkyWEdyPG0=": 2,                                         // #118 orientation,
            "WG9obh0Hb1U=": "l,n6HzJvD.+!C=",                        // #119 encrypted token/nonce,
            "AEcwBkYuNzU=": "11758352050875910640",                    // #120 entropy/session (ob to),
            ";;=?29?8:?:2=?3;:<>:": "88><1:<;9<91><089?=9",           // #121 XOR/shift 校验值,
            "a1BbUS46WWc=": opts.obStatus || 680,                      // #122 ob status (ao),
            "UBdgVhV/Z2c=": "jjsI",                                   // #123 obfuscation key fragment,
            "U0gjSRYiJHM=": [],                                        // #124 mimeTypes (空),
            "bHMccikbG0I=": {"LLJ":93},                                // #125 PX storage state,
            "bHMccioYGUk=": 93181610,                                   // #126 totalJSHeapSize (微变),
            "Vi1mLBBGZBs=": 4294967296,                                // #127 jsHeapSizeLimit (2^32),
            "BXp1O0MccQo=": 116634134,                                 // #128 usedJSHeapSize (微变),
            "cyhDaTVOQFs=": new Date().toString(),                     // #129 Date 字符串,
            "LDNcMmpYWQY=": false,                                     // #130 (detection),
            "TBN8Ugp7c2Q=": false,                                     // #131 Selenium,
            "DXJ9M0sUewM=": false,                                     // #132 callPhantom,
            "UBdgVhV6ZGE=": true,                                     // #133 isSecureContext,
            "QSYxZwRIPlU=": 0,                                        // #134 console timing,
            "IxgTGWVwEyM=": false,                                     // #135 OOGPD tamper,
            "AEcwBkYqMz0=": document.visibilityState,                  // #136 "visible",
            "WQ4pDxxjJzo=": false,                                     // #137 iframe sandbox,
            "b1RfVSk5UGA=": 0,                                         // #138 rtt,
            "XiVuJBtKbBY=": window.outerWidth,                        // #139 outerWidth,
            "CF84Hk0yPyg=": false,                                     // #140 (detection),
            "AEcwBkYvMjU=": window.outerHeight,                       // #141 outerHeight,
            "FCskKlJNJR8=": "missing",                                 // #142 WebGL2 检测,
            "QSYxZwRKM1E=": true,                                     // #143 (API detection),
            "KV4ZX281Gm0=": true,                                     // #144 (API detection),
            "P2QPJXkPDB8=": false,                                     // #145 languages empty,
            "KD9YPm5VWwo=": true,                                     // #146 (detection),
            "WG9obh0Ealw=": 0,                                        // #147 DevTools size diff,
            "QAdwRgVtdHU=": 1,                                        // #148 compatMode (standards),
            "EwhjCVZmYTg=": true,                                     // #149 Map/Set,
            "QAdwRgVpdX0=": false,                                     // #150 (detection),
            "X0QvRRkvKHQ=": true,                                     // #151 navigator.locks,
            "GwBrAV1razM=": true,                                     // #152 (API detection),
            "WiFqIBxLbRQ=": true,                                     // #153 document.fonts,
            "UTYhdxRcIkw=": true,                                     // #154 queueMicrotask,
            "fyRPZTlMS1E=": false,                                     // #155 permissions.query tamper,
            "dyxHbTFERV8=": true,                                     // #156 structuredClone,
            "dEsECjIsCjk=": 1,                                        // #157 compatMode,
            "N2wHLXEKAxg=": 0,                                        // #158 DevTools score,
            "UBdgVhZ/ZGY=": 0,                                        // #159 retry count,
            "NAtESnJhQ3E=": 0,                                        // #160 error count,
            "VQolCxNnIjo=": false,                                     // #161 NightmareJS,
            "ZHsUeiIQEk0=": false,                                     // #162 webdriver attribute,
            "cHcAdjUYBEc=": false,                                     // #163 headless,
            "CF84Hk0yOyw=": false,                                     // #164 Node.js Buffer,
            "LnVedGgcWk4=": false,                                     // #165 (detection),
            "fEMMAjoqCTM=": false,                                     // #166 (detection),
            "DzR/dUlZcE4=": false,                                     // #167 outerWidth=0,
            "TlV+FAgzei8=": false,                                     // #168 plugins=0,
            "KV4ZX280GG0=": false,                                     // #169 hasFocus false,
            "AEcwBkUoNzY=": false,                                     // #170 (detection),
            "O2ALIX0NCxs=": false,                                     // #171 (detection),
            "KD9YPm1SXgs=": false,                                     // #172 (detection),
            "HmUuZFsNLlc=": false,                                     // #173 (detection),
            "YjkSOCdSHQI=": "webkit",                                  // #174 CSS vendor prefix,
            "CzB7cU5beUI=": location.protocol,                         // #175 "https:",
            "OS4Jb3xFC18=": "function share() { [native code] }",     // #176 navigator.share.toString(),
            "DFM8Ekk4PiM=": Intl.DateTimeFormat().resolvedOptions().timeZone, // #177 "Asia/Shanghai",
            "U0gjSRYjInw=": "w3c",                                     // #178 event model,
            "XGNsYhkIbFY=": "screen",                                  // #179 PX 挂载点,
            "Fm0mbFMGJFs=": {"plugext":{"0":{"f":"internal-pdf-viewer","n":"PDF Viewer"},"1":{"f":"internal-pdf-viewer","n":"Chrome PDF Viewer"},"2":{"f":"internal-pdf-viewer","n":"Chromium PDF Viewer"},"3":{"f":"internal-pdf-viewer","n":"Microsoft Edge PDF Viewer"},"4":{"f":"internal-pdf-viewer","n":"WebKit built-in PDF"}},"plugins_len":5}, // #180,
            "dyxHbTJHSFw=": {"smd":{"ok":true,"ex":false}},            // #181 StorageManager,
            "IUYRR2QtEX0=": {},                                        // #182 cookie jar state,
            "JDtUOmFQWgw=": false,                                     // #183 HTMLElement tamper,
            "Vi1mLBNGZxg=": false,                                     // #184 attachShadow override,
            "KV4ZX2w1GWw=": "ff702ecc",                                // #185 Audio oscillator hash,
            "IUYRR2QtEXw=": {"support":true,"status":{"effectiveType":"4g","rtt":0,"downlink":10,"saveData":false}}, // #186 完整 connection 状态,
            "WiFqIB9KZRM=": "default",                                 // #187 Notification.permission,
            "KV4ZX2w1Fm8=": 3,                                        // #188 trust level,
            "LnVedGseUUE=": false,                                     // #189 domAutomationController,
            "X0QvRRovLHM=": true,                                     // #190 BroadcastChannel,
            "LVIdU2g5HWI=": "a529b701",                                // #191,
            "N2wHLXEHAxY=": "64556c77",                                // #192,
            "T3Q/NQkfOg8=": "",                                       // #193 referral token,
            "DXJ9M0gefQA=": "10207b2f",                                // #194 存储指纹,
            "Y1hTWSU+UGI=": "10207b2f",                                // #195 存储指纹 (同上),
            "LxQfFWp+HiM=": "90e65465",                                // #196 API 检测,
            "UTYhdxdbI0M=": true,                                     // #197 URL,
            "cHcAdjUdBUI=": true,                                     // #198 (API detection),
            "PANMQnpqQnE=": true,                                     // #199 (API detection),
            "aR5ZHy91Xyo=": true,                                     // #200 (API detection),
            "GwBrAV5rbjM=": true,                                     // #201 (API detection),
            "VQolCxBhID0=": "4YC/4YCb4YCR4YCA4YCd4YCB4YCd4YCU4YCG4YGS4YCi4YCT4YCH4YCe4YCb4YCc4YCT4YGS4YC94YCc4YCe4YCb4YCc4YCX4YGS4YGf4YGS4YCi4YCd4YCe4YCb4YCB4YCa4YGS4YGa4YCi4YCd4YCe4YCT4YCc4YCW4YGb", // #202 Myanmar 编码签名,
            "Jn1WfGMWU0k=": "3207084bd110f1ac964863e23aa78e04",        // #203 UA Client Hints MD5,
            "GwBrAV5qZDU=": null,                                     // #204 deferred value,
            "fEMMAjorDTM=": "9f762773",                                // #205 屏幕参数,
            "ajEaMC9cGQU=": "dae10548",                                // #206 时区语言,
            "ST45fwxTNkQ=": "",                                        // #207 cached state,
            "MklCCHQvTTk=": "a3d12c4",                                 // #208 硬件参数,
            "LDNcMmpUXgk=": "82002457",                                // #209 网络参数,
            "PkVOBHsvQTU=": "a3d12c4",                                 // #210 硬件参数 (同上),
            "fEMMAjkvDTA=": navigator.userAgent,                       // #211 UA (二次采集),
            "a1BbUS48WGo=": false,                                     // #212 Cypress,
            "QSYxZwdAP1I=": "90e65465",                                // #213 API 检测 (同上),
            "FCskKlFEJRE=": 1,                                         // #214 PX version flag,
            "ST45fw9ZPk8=": 1,                                         // #215 请求计数 (Bundle #2 = 1),
            "HCMsIlpILRA=": Math.floor(5000 + Math.random() * 5000),  // #216 random timing,
            "ICdQJmZKVBY=": collectTs,                                 // #217 采集完成时间戳,
            "GmEqYF8NKVo=": 3600,                                     // #218 TTL (固定),
            "HmUuZFgIIVM=": initTs,                                   // #219 事件起始时间戳,
            "KD9YPm1TVww=": buildTs,                                  // #220 payload 构建完成时间戳,
            "bRJdEyt4Uyc=": opts.uuid,                                 // #221 session UUID,
            "UTYhdxRdIEE=": opts.nsToken || null,                      // #222 /ns 端点 token,
            "Fm0mbFMGJ1s=": Math.random() * 2000,                     // #223 timing metric (float),
            "QSYxZwdLMVw=": false,                                     // #224 (固定 false),
            "ST45fwxTPko=": "PX11745",                                 // #225 event type ID,
            "Rl12HAA1dyY=": "pxhc" ,                                   // #226 handler context,
            "RTo1ewBXNkE=": false,                                     // #227 (固定 false),
            "b1RfVSo9WGQ=": opts.px3Cookie || "",                      // #228 _px3 cookie
        }
    }];
}

